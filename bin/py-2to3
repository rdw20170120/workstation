#!/usr/bin/env bash
set -e
# This script is intended to be executed by a user in a BASH shell.

# Convert all Python source from Python2 to Python3

if [[ -z "$DirProject" ]] ; then
    echo "FATAL: Environment variable 'DirProject' is undefined, aborting"
    exit 1
fi

# NOTE: Apparently, it is not possible to run Python3 code exclusively with the
# .py3 file extension, so do not add a suffix to the source files.

convert () {
    # Convert Python2 source files to Python3 within directory $1
    # $1 = directory within which to work

    local cmd="2to3"
    cmd+=" -npW"
    # cmd+=" -W"
    cmd+=" --fix=all"
    cmd+=" --fix=buffer"
    cmd+=" --fix=idioms"
    cmd+=" --fix=set_literal"
    cmd+=" --fix=ws_comma"
    cmd+=" --no-diffs"
    cmd+=" --verbose"
    $cmd $1 2>&1 \
        | grep -v 'Adding transformation' \
        | grep -v 'Descending into' \
        | grep -v 'No changes' \
        | grep -v 'Refactoring ' \
        | grep -v 'write-unchanged-files' \
        | grep -v 'Wrote changes'
}

convert $DirProject/bin         $screening
convert $DirProject/lib/python3 $screening
convert $DirProject/src         $screening

