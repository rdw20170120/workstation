#!/usr/bin/env bash
set -e
# This script is intended to be executed by a user in a BASH shell.

# Clean project directory
# TODO: Enhance to handle directories

if [[ -z "$BO_Project" ]] ; then
    echo "FATAL: Environment variable 'BO_Project' is undefined, aborting"
    exit 1
fi

if [[ -z "$PVE" ]] ; then
    echo "FATAL: Environment variable 'PVE' is undefined, aborting"
    exit 1
fi

findAnd () {
    # Find and perform action $1 on files within directory $2 matching pattern $3
    # $1 = action to perform, either 'delete' or 'print'
    # $2 = directory in which to work
    # $3 = filename pattern to match
    find $2 -not -path "$BO_Project/.git/*" -and -not -path "$PVE/*" -and -name "$3" -$1 -and -type f
}

echo "INFO: Found these files..."
findAnd print $BO_Project '__pycache'
findAnd print $BO_Project '*.bak'
findAnd print $BO_Project '*.pyc'

echo "INFO: Deleting files..."
findAnd delete $BO_Project '__pycache'
findAnd delete $BO_Project '*.bak'
findAnd delete $BO_Project '*.pyc'

dir=$BO_Project/src/.pytest_cache
echo "INFO: Deleting special directory '$dir' directly..."
rm -fr "$dir"

echo "WARN: Found these files REMAINING..."
findAnd print $BO_Project             '__pycache'
findAnd print $BO_Project             '*.bak'
findAnd print $BO_Project             '*.pyc'

