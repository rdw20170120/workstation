#!/usr/bin/env bash
# This script is intended to be executed by a user in a BASH shell.
set -e
# DISABLED: set -x

# Generate content

# Require activation
if [[ -z "$BO_Project" ]] ; then
    echo "FATAL: Environment variable 'BO_Project' is undefined, aborting"
    exit 1
fi

Script=$BO_Project/bin/lib/reference-Python-lib.bash
if [[ -r $Script ]] ; then
    source $Script
else
    echo "WARN: Script file '$Script' is not readable"
fi

# Require TMPDIR
if [[ -z "$TMPDIR" ]] ; then
    echo "FATAL: Environment variable 'TMPDIR' is undefined, aborting"
    exit 1
fi

# Recreate target directory
DirTgt=$TMPDIR/tgt
rm -fr "$DirTgt"
mkdir -p "$DirTgt"

echo "INFO: Generating content into directory '$DirTgt'"
cd $BO_Project/src
python3 -m generate "$DirTgt"

# Merge generated files into project directory
# TODO: Research why Meld does not open a new tab on macOS?
cmd='meld --newtab'
cmd+=" '$DirTgt' '$BO_Project'"
cmd+=' >/dev/null 2>&1 &'
echo "INFO: Use the following command to manually merge source updates:"
echo $cmd

