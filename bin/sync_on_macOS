#!/usr/bin/env bash
# Intended to be executed in a Bash shell.
[[ -n "${BO_Trace}" ]] && 1>&2 echo "Executing ${BASH_SOURCE}" && [[ "${BO_Trace}" != 'TRACE' ]] && set -vx
# NO: set -e
trap warn_on_error EXIT
###############################################################################
[[ -z "${BO_Project}" ]] &&
    1>&2 echo "ERROR: Aborting, this project is NOT ACTIVATED" &&
    exit 99

sync_directory() {
    # Synchronize directory trees
    require_arguments $# 2
    local -r DirSource=${BO_Project}/home/$2
    local -r DirTarget=${HOME}/$1

    maybe_create_directory_tree "${DirTarget}"
    ${my_sync} "${DirTarget}" "${DirSource}"
}

sync_file() {
    # Synchronize file
    require_arguments $# 3
    local -r DirSource=${BO_Project}/home/$2
    local -r DirTarget=${HOME}/$1
    local -r File=$3

    maybe_create_directory_tree "${DirTarget}"
    [[ ! -e "${DirSource}/${File}" ]] && touch "${DirSource}/${File}"
    [[ ! -e "${DirTarget}/${File}" ]] && touch "${DirTarget}/${File}"
    ${my_sync} "${DirTarget}/${File}" "${DirSource}/${File}"
}

main() {
    # Synchronize relevant files
    # against home directory tree
    # on Apple macOS
    require_arguments $# 0

    local my_sync=meld
    require_command_in my_sync

    sync_directory .config macOS/.config
    sync_directory .ssh .ssh
    sync_directory bin  bin

    sync_file . macOS .bash_profile
    sync_file . macOS .bashrc
    sync_file . macOS alias.bash

    sync_file . macOS .inputrc

#   sync_file . macOS .zshrc
#   sync_file . macOS alias.zsh

    return 0
}

main $@

###############################################################################
# NOTE: Uncomment these lines for debugging, placed where needed
# export PS4='$ ' ; set -vx
# Code to debug...
# set +vx

: << 'DisabledContent'
DisabledContent

